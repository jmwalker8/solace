<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Solace: A platform designed to help individuals with ADHD through educational content, tips, and resources. Explore, learn, and stay organized.">
    <meta name="keywords" content="ADHD, tips, ADHD education, motivation, lifestyle, ADHD strategies, mental health, ADHD resources">
    <meta name="author" content="Solace Team">
  <title>Solace ADHD</title>

  <meta name="description" content="Access a curated collection of ADHD educational videos and resources to support your journey.">

    <meta property="og:title" content="Solace - Your ADHD Companion">
    <meta property="og:description" content="Explore educational content, strategies, and tips for ADHD. Designed for children, teens, and adults with ADHD.">
    <meta property="og:image" content="https://solaceadhd.com/assets/og-image.jpg">
    <meta property="og:url" content="https://solaceadhd.com">
    <meta property="og:type" content="website">

    <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Solace - Your ADHD Companion">
  <meta name="twitter:description" content="Explore ADHD-focused content and strategies on Solace. Stay motivated, learn, and find the support you need.">
  <meta name="twitter:image" content="https://solaceadhd.com/assets/og-image.jpg">
  <!-- Load Tailwind first -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Load Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
  
  <!-- Load React -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/babel-standalone@6.26.0/babel.min.js"></script>

  <!-- Google tag (gtag.js) --> <script async src="https://www.googletagmanager.com/gtag/js?id=AW-16832194187"> </script> 
  <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'AW-16832194187'); </script>
  <!-- Event snippet for Page view conversion page --> <script> gtag('event', 'conversion', { 'send_to': 'AW-16832194187/zpHwCI_sopMaEIvNm9o-', 'value': 1.0, 'currency': 'USD' }); </script>
</head>
<style>
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .fade-in {
    animation: fadeIn 0.5s ease-out;
  }
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    50% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
}

.animate-shake {
    animation: shake 0.5s ease-in-out;
}

@keyframes confetti-fall {
    0% { transform: translateY(-100vh) rotate(0deg); }
    100% { transform: translateY(100vh) rotate(360deg); }
}

input:focus, textarea:focus {
    border-color: #58A6FF;
    box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3);
    transition: all 0.3s ease-in-out;
}

button:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.2s ease-in-out;
}
</style>
<body>
    <div id="root"></div>
    
    <script type="text/babel" type="module">

    // Firebase configuration
    const firebaseConfig = {
        apiKey: 'AIzaSyA3V8kM0CKK5SiQGu1EOaV7kCeowl1cRCI',
        authDomain: 'solace-83466.firebaseapp.com',
        databaseURL: 'https://solace-83466-default-rtdb.firebaseio.com',
        projectId: 'solace-83466',
        storageBucket: 'solace-83466.appspot.com',
        messagingSenderId: '1035507922270',
        appId: '1:1035507922270:web:496b548ba710523eb18bcf',
        measurementId: 'G-H8RRCK340M',
    };
    
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }

    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    const HF_API_KEY = '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';

    class ErrorBoundary extends React.Component {
    constructor(props) {
        super(props);
        this.state = { hasError: false };
    }

    static getDerivedStateFromError(error) {
        return { hasError: true };
    }

    componentDidCatch(error, errorInfo) {
        console.error("Error caught by error boundary:", error, errorInfo);
    }

    render() {
        if (this.state.hasError) {
            return <div className="text-red-500 p-4">Something went wrong. Please try again later.</div>;
        }
        return this.props.children;
    }
}

    // Constants
    const RESOURCE_CATEGORIES = [
        { id: 'productivity', label: 'Productivity', icon: '‚ö°' },
        { id: 'study', label: 'Study', icon: 'üìö' },
        { id: 'work', label: 'Work', icon: 'üíº' },
        { id: 'health', label: 'Health', icon: 'üå±' },
        { id: 'routine', label: 'Routine', icon: '‚è∞' },
        { id: 'focus', label: 'Focus', icon: 'üéØ' }
    ];

    const QUICK_TIPS = [
        'Set a 3-minute timer to break down your task',
        'Write down just THREE things to do today',
        'Take a quick movement break',
        'Drink some water and stretch',
        'Clear one small space near you',
        'Put on focus music for 25 minutes'
    ];

    const colors = {
        bg: {
            primary: "bg-[#0D1117]", // Dark base
            secondary: "bg-[#161B22]", // Slightly lighter for cards
            accent: "bg-[#21262D]", // For interactive elements
        },
        text: {
            primary: "text-[#E6EDF3]", // Soft white for readability
            secondary: "text-[#8B949E]", // Muted text for less important info
            accent: "text-[#58A6FF]", // Vibrant blue for links and buttons
        },
        border: "border-[#30363D]", // Subtle borders
        button: {
            primary: "bg-[#238636] hover:bg-[#2EA043]", // Green for primary actions
            secondary: "bg-[#21262D] hover:bg-[#30363D]", // Dark for secondary actions
            glow: "shadow-[0_0_8px_rgba(88,166,255,0.6)]", // Glow effect for buttons
        },
    };

    function getDefaultStrategies() {
  return [
    {
      id: 'default-1-' + Date.now(),
      title: 'The Pomodoro Technique',
      description: '1. Choose one specific subject to study\n2. Set a timer for 25 minutes\n3. Study with complete focus until the timer rings\n4. Take a 5-minute break\n5. After 4 cycles, take a longer 15-30 minute break\n\nThis technique helps maintain focus and prevents burnout by breaking study sessions into manageable chunks.',
      timeToComplete: '25 minutes per session',
      tags: ['Time Management', 'Focus'],
      progress: 0,
      postedBy: 'AI Assistant',
      likes: 0,
      liked: false
    },
    {
      id: 'default-2-' + Date.now(),
      title: 'Active Recall Method',
      description: '1. Read a section of your study material\n2. Close the book or notes\n3. Write down everything you remember\n4. Check your notes for accuracy\n5. Focus on areas you missed\n\nActive recall is one of the most effective study techniques, especially for ADHD learners, as it keeps your mind actively engaged.',
      timeToComplete: '15 minutes per topic',
      tags: ['Study Skills', 'Memory'],
      progress: 0,
      postedBy: 'AI Assistant',
      likes: 0,
      liked: false
    },
    {
      id: 'default-3-' + Date.now(),
      title: 'Body Doubling Study Session',
      description: '1. Find a study buddy or join an online study room\n2. Share your study goals for the session\n3. Study in parallel with others\n4. Take synchronized breaks\n5. Share progress at the end\n\nBody doubling (studying in the presence of others) can help maintain focus and accountability.',
      timeToComplete: '1 hour',
      tags: ['Accountability', 'Social Learning'],
      progress: 0,
      postedBy: 'AI Assistant',
      likes: 0,
      liked: false
    }
  ];
}

    const ProgressBar = ({ progress }) => (
        <div className="w-full bg-gray-200 rounded-full h-2">
            <div
                className="bg-[#58A6FF] h-2 rounded-full"
                style={{ width: `${progress}%` }}
            />
        </div>
    );

    const loadUserData = async (userId) => {
    try {
        const snapshot = await firebase.database().ref(`users/${userId}`).once('value');
        const userData = snapshot.val();
        setUserProfile(userData || { username: 'User', resourcesShared: 0, resourcesCompleted: 0 });
    } catch (error) {
        console.error('Error loading user data:', error);
    }
};

    const NavigationIcons = {
        Home: () => (
            <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
            </svg>
        ),
        Discover: () => (
            <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        ),
        Create: () => (
            <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 4v16m8-8H4" />
            </svg>
        ),
        Profile: () => (
            <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
        )
    };

    // Utility Components
    const LoadingSpinner = () => (
        <div className="flex justify-center items-center">
            <div className="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-500"></div>
        </div>
    );

    // Auth Components
    const AuthModal = ({ onClose, isLogin = true }) => {
    const [email, setEmail] = React.useState('');
    const [password, setPassword] = React.useState('');
    const [error, setError] = React.useState('');

    const handleAuth = async (e) => {
    e.preventDefault();
    setError('');

    try {
        if (isLogin) {
            // Login
            await auth.signInWithEmailAndPassword(email, password);
        } else {
            // Sign up
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            const user = userCredential.user;
            
            // Initialize user profile in Firebase
            await firebase.database().ref(`users/${user.uid}`).set({
                username: email.split('@')[0], // Default username
                resourcesShared: 0,
                resourcesCompleted: 0
            });
        }
        onClose();
    } catch (error) {
        setError(error.message);
    }
};

    return (
        <div className="fixed inset-0 bg-[#0D1117]/95 z-50 flex items-center justify-center p-4 backdrop-blur-xl">
            <div className={`${colors.bg.secondary} rounded-xl p-8 max-w-md w-full border ${colors.border}`}>
                <div className="flex justify-between items-center mb-6">
                    <h2 className="text-xl font-semibold text-[#58A6FF]">
                        {isLogin ? 'Welcome Back' : 'Join ADHDFlow'}
                    </h2>
                    <button onClick={onClose} className="text-[#8B949E] hover:text-[#C9D1D9]">
                        ‚úï
                    </button>
                </div>

                <form className="space-y-4" onSubmit={handleAuth}>
                    <input
                        type="email"
                        placeholder="Email"
                        value={email}
                        onChange={(e) => setEmail(e.target.value)}
                        className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
                            ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
                        required
                    />
                    <input
                        type="password"
                        placeholder="Password"
                        value={password}
                        onChange={(e) => setPassword(e.target.value)}
                        className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
                            ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
                        required
                    />
                    {error && <p className="text-red-500 text-sm">{error}</p>}
                    <button type="submit" className="w-full bg-[#58A6FF] text-white py-3 rounded-lg hover:bg-[#58A6FF]/90 transition-all duration-300">
                        {isLogin ? 'Login' : 'Create Account'}
                    </button>
                </form>
            </div>
        </div>
    );
};

    // Navigation Component
    const Navigation = ({ currentPage, setCurrentPage }) => (
    <nav className={`fixed bottom-0 left-0 right-0 ${colors.bg.secondary} backdrop-blur-xl border-t ${colors.border}`}>
        <div className="max-w-4xl mx-auto px-4">
            <div className="flex justify-between py-3">
                {[
                    {
                        icon: <NavigationIcons.Home />,
                        id: 'main',
                        label: 'Home'
                    },
                    {
                        icon: <NavigationIcons.Discover />,
                        id: 'discover',
                        label: 'Discover'
                    },
                    {
                        icon: <NavigationIcons.Create />,
                        id: 'post',
                        label: 'Post'
                    },
                    {
                        icon: <NavigationIcons.Profile />,
                        id: 'profile',
                        label: 'Profile'
                    }
                ].map(({ icon, id, label }) => (
                    <button
                        key={id}
                        onClick={() => setCurrentPage(id)}
                        className={`px-4 py-2 rounded-lg transition-all duration-300 ${
                            currentPage === id 
                                ? 'text-[#58A6FF] bg-[#58A6FF]/10' 
                                : 'text-[#8B949E] hover:text-[#58A6FF] hover:bg-[#21262D]'
                        }`}
                    >
                        <div className="flex flex-col items-center gap-1">
                            {icon}
                            <span className="text-xs">{label}</span>
                        </div>
                    </button>
                ))}
            </div>
        </div>
    </nav>
);

    // Resource Card Component
   
    const ResourceCard = ({ resource, onUpvote, onDownvote, onSave, isSaved, setCurrentPage}) => {
    if (!resource) return null;

    const {
        title = '',
        description = '',
        tags = [],
        timeToComplete = '',
        progress = 0,
        upvotes = [],
        downvotes = [],
        postedBy = 'Anonymous',
        thumbnail = '',
        link = ''
    } = resource;

    const userId = auth.currentUser ? auth.currentUser.uid : null;
    const hasUpvoted = userId && upvotes.includes(userId);
    const hasDownvoted = userId && downvotes.includes(userId);

    const handleLinkClick = (e) => {
        e.stopPropagation();
        if (link) {
            window.open(link, '_blank', 'noopener,noreferrer');
        }
    };

    return (
        <div className={`${colors.bg.secondary} rounded-xl p-6 border ${colors.border} 
            hover:bg-[#1C2128] transition-all duration-300 group fade-in`}>
            
            {thumbnail && (
                <div className="w-full h-48 overflow-hidden rounded-lg mb-4 relative">
                    <img
                        src={thumbnail}
                        alt={title}
                        className="w-full h-full object-cover object-center"
                    />
                </div>
            )}

            <div className="space-y-4">
                <div className="flex justify-between items-start">
                    <h3 className="text-lg font-medium text-[#58A6FF] opacity-90">
                        {title}
                    </h3>
                    <div className="flex gap-2">
                        <button 
                            onClick={() => onUpvote(resource.id)}
                            className={`p-2 rounded-lg transition-colors duration-300 
                                ${hasUpvoted ? 'text-green-500 bg-green-500/10' : 'text-[#8B949E] hover:text-green-500'}`}
                        >
                            üëç {upvotes.length}
                        </button>
                        <button 
                            onClick={() => onDownvote(resource.id)}
                            className={`p-2 rounded-lg transition-colors duration-300 
                                ${hasDownvoted ? 'text-red-500 bg-red-500/10' : 'text-[#8B949E] hover:text-red-500'}`}
                        >
                            üëé {downvotes.length}
                        </button>
                        <button 
                            onClick={() => onSave(resource.id)}
                            className={`p-2 rounded-lg transition-colors duration-300 
                                ${isSaved ? 'text-[#58A6FF] bg-[#58A6FF]/10' : 'text-[#8B949E] hover:text-[#58A6FF]'}`}
                        >
                            üîñ
                        </button>
                    </div>
                </div>

                <p className={`${colors.text.secondary} leading-relaxed whitespace-pre-line`}>
                    {description}
                </p>

                <div className="w-full bg-gray-200 rounded-full h-2">
                    <div
                        className="bg-[#58A6FF] h-2 rounded-full"
                        style={{ width: `${progress}%` }}
                    />
                </div>

                <div className="flex flex-wrap gap-2">
                    {Array.isArray(tags) && tags.map(tag => (
                        <span key={tag} 
                            className="px-3 py-1 rounded-full text-sm bg-[#21262D] text-[#58A6FF] border border-[#30363D]">
                            {tag}
                        </span>
                    ))}
                </div>

                <div className="flex items-center gap-4 text-sm text-[#8B949E] pt-4 border-t border-[#30363D]">
                    <span>‚è±Ô∏è {timeToComplete}</span>
                    <button
                onClick={() => setCurrentPage(`profile-${postedBy}`)}
                className="hover:text-[#58A6FF] transition-colors duration-300"
            >
                Posted by @{postedBy}
            </button>

                    {link && (
                        <button
                            onClick={handleLinkClick}
                            className="ml-auto px-4 py-2 bg-[#58A6FF] text-white rounded-lg 
                                hover:bg-[#58A6FF]/90 transition-all duration-300 flex items-center gap-2"
                        >
                            <span>Go to Resource</span>
                            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                                    d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                    )}
                </div>
            </div>
        </div>
    );
};


    // Quick Win Card Component
    const QuickWinCard = ({ onOverwhelm, currentTip }) => (
        <div className={`relative ${colors.bg.secondary} rounded-xl p-6 mb-8 ${colors.border} border backdrop-blur-xl 
            hover:bg-[#1C2128] transition-all duration-300`}>
            <div className="flex justify-between items-start">
                <div className="space-y-2">
                    <h3 className="text-sm font-medium text-[#58A6FF] flex items-center gap-2 opacity-80">
                        <span>‚ú®</span>Quick Win for Today
                    </h3>
                    <p className={`${colors.text.primary} text-lg leading-relaxed`}>
                        {currentTip}
                    </p>
                </div>
                <button
                    onClick={onOverwhelm}
                    className="px-4 py-2 rounded-full text-sm bg-[#21262D] text-[#58A6FF] hover:bg-[#2C323A] 
                        transition-all duration-300 border border-[#30363D] hover:border-[#58A6FF]/30"
                >
                    I'm Overwhelmed
                </button>
            </div>
        </div>
    );

    const OverwhelmModal = ({ onClose }) => {
        const [step, setStep] = React.useState(1);
        const [breathCount, setBreathCount] = React.useState(0);
        const [seconds, setSeconds] = React.useState(4);
        const [breathingPhase, setBreathingPhase] = React.useState('inhale'); // 'inhale' or 'exhale'

        React.useEffect(() => {
            if (step === 1 && breathCount < 3) {
                const timer = setInterval(() => {
                    if (seconds > 0) {
                        setSeconds(s => s - 1);
                    } else {
                        if (breathingPhase === 'inhale') {
                            setBreathingPhase('exhale');
                            setSeconds(4);
                        } else {
                            setBreathingPhase('inhale');
                            setSeconds(4);
                            setBreathCount(b => b + 1);
                        }
                    }
                }, 1000);
                return () => clearInterval(timer);
            }
        }, [step, breathCount, seconds, breathingPhase]);

        return (
            <div className="fixed inset-0 bg-gray-950/95 z-50 flex items-center justify-center p-4 backdrop-blur-xl">
                <div className="bg-gray-900 rounded-xl p-8 max-w-md w-full border border-purple-700/50">
                    {step === 1 && (
                        <div className="space-y-6">
                            <h3 className="text-xl font-semibold text-purple-300">Breathing Exercise</h3>
                            <div className="flex flex-col items-center">
                                <div className={`w-32 h-32 rounded-full border-4 
                                    ${breathingPhase === 'inhale' ? 'border-purple-500 scale-110' : 'border-pink-500 scale-100'}
                                    transition-all duration-1000 flex items-center justify-center`}>
                                    <span className="text-2xl font-bold text-purple-300">{seconds}</span>
                                </div>
                                <p className="mt-4 text-gray-300">
                                    {breathingPhase === 'inhale' ? 'Breathe In...' : 'Breathe Out...'}
                                </p>
                                <p className="text-sm text-gray-400 mt-2">
                                    {breathCount}/3 breaths completed
                                </p>
                            </div>
                            {breathCount >= 3 && (
                                <button
                                    onClick={() => setStep(2)}
                                    className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700"
                                >
                                    Next: Grounding
                                </button>
                            )}
                        </div>
                    )}

                    {step === 2 && (
                        <div className="space-y-6">
                            <h3 className="text-xl font-semibold text-purple-300">Grounding Exercise</h3>
                            <div className="space-y-4">
                                <p className="text-gray-300">Name 3 things you can:</p>
                                <div className="space-y-2">
                                    <input 
                                        placeholder="See..."
                                        className="w-full p-3 bg-gray-800 rounded-lg border border-gray-700"
                                    />
                                    <input 
                                        placeholder="Hear..."
                                        className="w-full p-3 bg-gray-800 rounded-lg border border-gray-700"
                                    />
                                    <input 
                                        placeholder="Feel..."
                                        className="w-full p-3 bg-gray-800 rounded-lg border border-gray-700"
                                    />
                                </div>
                                <button
                                    onClick={() => setStep(3)}
                                    className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700"
                                >
                                    Next: Small Task
                                </button>
                            </div>
                        </div>
                    )}

                    {step === 3 && (
                        <div className="space-y-6">
                            <h3 className="text-xl font-semibold text-purple-300">Choose One Small Task</h3>
                            <div className="space-y-3">
                                {[
                                    'Drink a glass of water',
                                    'Stretch for one minute',
                                    'Write down whats on your mind',
                                    'Clear one small space',
                                    'Take a 2-minute walk'
                                ].map(task => (
                                    <button
                                        key={task}
                                        onClick={() => {
                                            // Here we would log the completed task
                                            onClose();
                                        }}
                                        className="w-full text-left p-4 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors duration-300"
                                    >
                                        {task}
                                    </button>
                                ))}
                            </div>
                        </div>
                    )}

                    <button
                        onClick={onClose}
                        className="absolute top-4 right-4 text-gray-400 hover:text-gray-300"
                    >
                        ‚úï
                    </button>
                </div>
            </div>
        );
    };

    // Search Bar Component
    const SearchBar = ({ value, onChange, onSubmit }) => (
    <div className="relative mb-8">
        <div className={`${colors.bg.secondary} rounded-xl p-6 border ${colors.border} backdrop-blur-xl`}>
            <h2 className={`text-xl font-medium ${colors.text.primary} mb-4`}>
                What are you trying to do today?
            </h2>
            <div className="relative">
                <input
                    type="text"
                    value={value}
                    onChange={onChange}
                    onKeyPress={(e) => {
                        if (e.key === 'Enter') {
                            onSubmit();
                        }
                    }}
                    className={`w-full p-4 pl-12 ${colors.bg.accent} rounded-lg border ${colors.border} 
                        ${colors.text.primary} placeholder-[#8B949E] focus:border-[#58A6FF]/30 
                        focus:bg-[#2C323A] transition-all duration-300`}
                    placeholder="E.g., I need to write a paper..."
                />
                <span className="absolute left-4 top-1/2 -translate-y-1/2 text-[#8B949E]">
                    <svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                        <path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                </span>
            </div>
        </div>
    </div>
);

const DiscoverPage = ({ resources, onUpvote, onDownvote, onSave, savedResources,  setCurrentPage }) => {
    const [activeFilter, setActiveFilter] = React.useState('all');

    const filteredResources = React.useMemo(() => {
        switch (activeFilter) {
          case 'popular':
    return [...resources].sort((a, b) => {
        const aScore = ((a.upvotes && a.upvotes.length) || 0) - ((a.downvotes && a.downvotes.length) || 0);
        const bScore = ((b.upvotes && b.upvotes.length) || 0) - ((b.downvotes && b.downvotes.length) || 0);
        return bScore - aScore;
    });
            case 'recent':
                return [...resources].sort((a, b) => b.createdAt - a.createdAt);
            case 'all':
            default:
                return resources;
        }
    }, [resources, activeFilter]);

    return (
        <div className="space-y-6">
            <h2 className="text-xl font-semibold text-purple-300">Discover Resources</h2>
            
            <div className="flex gap-2 overflow-x-auto pb-2">
                {['all', 'popular', 'recent', 'productivity', 'study', 'focus'].map(filter => (
                    <button
                        key={filter}
                        onClick={() => setActiveFilter(filter)}
                        className={`px-4 py-2 rounded-full text-sm whitespace-nowrap ${
                            activeFilter === filter 
                                ? 'bg-purple-600 text-white' 
                                : 'bg-gray-800 text-gray-300 hover:bg-gray-700'
                        }`}
                    >
                        {filter.charAt(0).toUpperCase() + filter.slice(1)}
                    </button>
                ))}
            </div>

            <div className="grid gap-4">
                {filteredResources.map(resource => (
                  <ResourceCard
    key={resource.id}
    resource={resource}
    onUpvote={handleUpvote}
    onDownvote={handleDownvote}
    onSave={handleSaveResource}
    isSaved={savedResources.includes(resource.id)}
    setCurrentPage={setCurrentPage}
/>

                ))}
            </div>
        </div>
    );
};

    const SuccessMessage = () => (
    <div className="fixed bottom-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg fade-in">
        üéâ Resource posted successfully!
    </div>
);

const ErrorMessage = ({ message }) => (
    <div className="fixed bottom-4 right-4 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg animate-shake">
        ‚ùå {message}
    </div>
);

const handleUpvote = async (resourceId) => {
    if (!auth.currentUser) {
        alert('Please log in to upvote a resource.');
        return;
    }

    try {
        const resourceRef = firebase.database().ref(`resources/${resourceId}`);
        const snapshot = await resourceRef.once('value');
        const resource = snapshot.val();

        if (resource) {
            const upvotes = resource.upvotes || [];
            const downvotes = resource.downvotes || [];
            const userId = auth.currentUser.uid;

            if (upvotes.includes(userId)) {
                await resourceRef.update({
                    upvotes: upvotes.filter(id => id !== userId)
                });
            } else {
                await resourceRef.update({
                    upvotes: [...upvotes, userId],
                    downvotes: downvotes.filter(id => id !== userId)
                });
            }
            loadResources();
        }
    } catch (error) {
        console.error('Error upvoting resource:', error);
    }
};


const handleDownvote = async (resourceId) => {
    if (!user) {
        alert('Please log in to downvote a resource.');
        return;
    }

    try {
        const resourceRef = firebase.database().ref(`resources/${resourceId}`);
        const snapshot = await resourceRef.once('value');
        const resource = snapshot.val();

        if (resource) {
            const upvotes = resource.upvotes || [];
            const downvotes = resource.downvotes || [];
            const userId = user.uid;

            // Check if user has already downvoted
            if (downvotes.includes(userId)) {
                // Remove downvote
                await resourceRef.update({
                    downvotes: downvotes.filter(id => id !== userId)
                });
            } else {
                // Add downvote and remove upvote if exists
                await resourceRef.update({
                    downvotes: [...downvotes, userId],
                    upvotes: upvotes.filter(id => id !== userId)
                });
            }

            // Refresh resources to update UI
            loadResources();
        }
    } catch (error) {
        console.error('Error downvoting resource:', error);
    }

    
};

const handleSaveResource = async (resourceId) => {
    if (!user) {
        alert('Please log in to save a resource.');
        return;
    }

    try {
        const userRef = firebase.database().ref(`users/${user.uid}/savedResources`);
        const snapshot = await userRef.once('value');
        const savedResources = snapshot.val() || [];

        if (!savedResources.includes(resourceId)) {
            // Add the resource to saved list
            await userRef.set([...savedResources, resourceId]);
            setSavedResources(prev => [...prev, resourceId]);
        } else {
            // Remove the resource from saved list
            const updatedSavedResources = savedResources.filter(id => id !== resourceId);
            await userRef.set(updatedSavedResources);
            setSavedResources(updatedSavedResources);
        }
    } catch (error) {
        console.error('Error saving resource:', error);
    }
};



const PostPage = ({ user, onPost }) => {
  const [formData, setFormData] = React.useState({
    title: '',
    description: '',
    tags: [],
    timeToComplete: '',
    progress: 0,
    thumbnail: null,
    link: '', // Add this new field
  });
  const [isLoading, setIsLoading] = React.useState(false);
  const [isSuccess, setIsSuccess] = React.useState(false);
  const [error, setError] = React.useState('');

  // Predefined tags
  const PREDEFINED_TAGS = [
    'Productivity',
    'Study',
    'Focus',
    'Health',
    'Routine',
    'Work',
    'Mindfulness',
    'Time Management',
  ];

  // Handle file upload
  const handleFileChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      setFormData({ ...formData, thumbnail: file });
    }
  };

  // Handle tag selection
  const handleTagChange = (tag) => {
    const updatedTags = formData.tags.includes(tag)
      ? formData.tags.filter((t) => t !== tag) // Remove if already selected
      : [...formData.tags, tag]; // Add if not selected
    setFormData({ ...formData, tags: updatedTags });
  };

  <input
    type="url"
    placeholder="Resource Link (optional)"
    value={formData.link}
    onChange={(e) => setFormData({ ...formData, link: e.target.value })}
    className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
      ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
  />

  // Handle form submission
  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    setError('');

    try {
        let thumbnailUrl = '';
        if (formData.thumbnail) {
            const storageRef = storage.ref(`thumbnails/${formData.thumbnail.name}`);
            await storageRef.put(formData.thumbnail);
            thumbnailUrl = await storageRef.getDownloadURL();
        }

        const newResource = {
            title: formData.title,
            description: formData.description,
            tags: formData.tags,
            timeToComplete: formData.timeToComplete,
            progress: formData.progress,
            thumbnail: thumbnailUrl,
            link: formData.link, // Add this line
            postedBy: user.uid,
            upvotes: [],
            downvotes: [],
            createdAt: firebase.database.ServerValue.TIMESTAMP,
        };

        const ref = firebase.database().ref('resources').push();
        await ref.set(newResource);
        
        // Reset form
        setFormData({
            title: '',
            description: '',
            tags: [],
            timeToComplete: '',
            progress: 0,
            thumbnail: null,
            link: '', // Add this line
        });

        onPost();
    } catch (error) {
        setError('Failed to post resource. Please try again.');
        console.error('Error posting resource:', error);
    }
};

  return (
    <div className="space-y-6">
      <h2 className="text-xl font-semibold text-gray-300">Share a Resource</h2>
      <form onSubmit={handleSubmit} className="space-y-4">
        {/* Title */}
        <input
          type="text"
          placeholder="Title"
          value={formData.title}
          onChange={(e) => setFormData({ ...formData, title: e.target.value })}
          className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
            ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
          required
        />

        {/* Description */}
        <textarea
          placeholder="Description"
          value={formData.description}
          onChange={(e) => setFormData({ ...formData, description: e.target.value })}
          className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
            ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
          required
        />

        {/* Thumbnail Upload */}
        <div>
          <label className={`block text-sm font-medium ${colors.text.secondary} mb-2`}>
            Thumbnail (Optional)
          </label>
          <input
            type="file"
            accept="image/*"
            onChange={handleFileChange}
            className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
              ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
          />
        </div>

        {/* Predefined Tags */}
        <div>
          <label className={`block text-sm font-medium ${colors.text.secondary} mb-2`}>
            Tags (Select up to 3)
          </label>
          <div className="flex flex-wrap gap-2">
            {PREDEFINED_TAGS.map((tag) => (
              <button
                key={tag}
                type="button"
                onClick={() => handleTagChange(tag)}
                className={`px-3 py-1 rounded-full text-sm ${
                  formData.tags.includes(tag)
                    ? 'bg-[#58A6FF] text-white'
                    : 'bg-[#21262D] text-[#8B949E] hover:bg-[#2C323A]'
                } transition-all duration-300`}
              >
                {tag}
              </button>
            ))}
          </div>
        </div>

        {/* Time to Complete */}
        <input
          type="text"
          placeholder="Time to Complete"
          value={formData.timeToComplete}
          onChange={(e) => setFormData({ ...formData, timeToComplete: e.target.value })}
          className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
            ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
          required
        />

        {/* Progress */}
        <input
          type="number"
          placeholder="Progress (0-100)"
          value={formData.progress}
          onChange={(e) => setFormData({ ...formData, progress: parseInt(e.target.value) })}
          className={`w-full p-3 ${colors.bg.accent} rounded-lg border ${colors.border} 
            ${colors.text.primary} focus:border-[#58A6FF]/30 transition-all duration-300`}
          min="0"
          max="100"
          required
        />

        {/* Submit Button */}
        <button
          type="submit"
          className="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700"
          disabled={isLoading}
        >
          {isLoading ? 'Posting...' : 'Post Resource'}
        </button>
      </form>

      {isSuccess && <SuccessMessage />}
      {error && <ErrorMessage message={error} />}
      {isLoading && <LoadingSpinner />}
    </div>
  );
};

const Confetti = () => (
    <div className="fixed inset-0 z-50 pointer-events-none">
        {Array.from({ length: 100 }).map((_, i) => (
            <div
                key={i}
                className="absolute w-2 h-2 bg-yellow-400 rounded-full"
                style={{
                    left: `${Math.random() * 100}vw`,
                    top: `${Math.random() * 100}vh`,
                    animation: `confetti-fall ${Math.random() * 3 + 2}s linear`,
                }}
            />
        ))}
    </div>
);

function calculateRelevanceScore(resource, searchQuery) {
  if (!resource || !searchQuery) return 0;
  
  const query = searchQuery.toLowerCase();
  const words = query.split(' ').filter(word => word.length > 2);
  let score = 0;

  // Check title
  if (resource.title && resource.title.toLowerCase().includes(query)) {
    score += 3;
  }

  // Check description
  if (resource.description) {
    const description = resource.description.toLowerCase();
    words.forEach(function(word) {
      if (description.includes(word)) {
        score += 1;
      }
    });
  }

  // Check tags
  if (Array.isArray(resource.tags)) {
    words.forEach(function(word) {
      resource.tags.forEach(function(tag) {
        if (tag.toLowerCase().includes(word)) {
          score += 2;
        }
      });
    });
  }

  return score;
}


function searchResources(resources, query) {
  if (!query.trim() || !Array.isArray(resources)) {
    return resources;
  }

  // Score and filter resources
  const scoredResources = resources
    .map(function(resource) {
      return {
        resource: resource,
        score: calculateRelevanceScore(resource, query)
      };
    })
    .filter(function(item) {
      return item.score > 0;
    })
    .sort(function(a, b) {
      return b.score - a.score;
    });

  return scoredResources.map(function(item) {
    return item.resource;
  });
}

const AISuggestionsSection = ({ onSubmit, isLoading }) => {
  const [query, setQuery] = React.useState('');
  const [showExamples, setShowExamples] = React.useState(true);

  const examples = [
    "I need to focus while studying",
    "I keep procrastinating on important tasks",
    "I need help organizing my daily routine",
    "I get overwhelmed with big projects"
  ];

  return (
    <div className={`${colors.bg.secondary} rounded-xl p-6 border ${colors.border} mb-8`}>
      <div className="space-y-4">
        <div className="flex items-center gap-2">
          <span className="text-2xl">ü§ñ</span>
          <h2 className={`text-xl font-medium ${colors.text.primary}`}>
            AI Resource Finder
          </h2>
        </div>
        
        <p className={`${colors.text.secondary}`}>
          Describe what you're trying to achieve or what you're struggling with, 
          and I'll suggest personalized resources and strategies.
        </p>

        <div className="relative">
          <textarea
            value={query}
            onChange={(e) => setQuery(e.target.value)}
            placeholder="E.g., I need help breaking down large tasks into manageable pieces..."
            className={`w-full p-4 ${colors.bg.accent} rounded-lg border ${colors.border}
              ${colors.text.primary} placeholder-[#8B949E] focus:border-[#58A6FF]/30
              focus:bg-[#2C323A] transition-all duration-300 min-h-[100px]`}
          />
          
          <button
            onClick={() => onSubmit(query)}
            disabled={isLoading || !query.trim()}
            className={`mt-2 px-6 py-2 bg-[#58A6FF] text-white rounded-lg 
              hover:bg-[#58A6FF]/90 transition-all duration-300
              disabled:opacity-50 disabled:cursor-not-allowed
              flex items-center gap-2`}
          >
            {isLoading ? (
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin" />
                <span>Finding Resources...</span>
              </div>
            ) : (
              <div className="flex items-center gap-2">
                <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} 
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <span>Find Resources</span>
              </div>
            )}
          </button>
        </div>

        {showExamples && (
          <div className="mt-4">
            <p className={`text-sm ${colors.text.secondary} mb-2`}>
              Try asking about:
            </p>
            <div className="flex flex-wrap gap-2">
              {examples.map((example) => (
                <button
                  key={example}
                  onClick={() => {
                    setQuery(example);
                    setShowExamples(false);
                  }}
                  className={`px-3 py-1 rounded-full text-sm 
                    bg-[#21262D] text-[#58A6FF] border border-[#30363D]
                    hover:bg-[#2C323A] transition-colors duration-300`}
                >
                  {example}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
};

const ProfilePage = ({ userId, userProfile, savedResources }) => {
    const [profileData, setProfileData] = React.useState(null);
    const [loading, setLoading] = React.useState(true);

    React.useEffect(() => {
        const fetchProfileData = async () => {
            try {
                const snapshot = await firebase.database().ref(`users/${userId}`).once('value');
                const data = snapshot.val();
                setProfileData(data);
            } catch (error) {
                console.error('Error fetching profile data:', error);
            } finally {
                setLoading(false);
            }
        };

        if (userId) {
            fetchProfileData();
        }
    }, [userId]);

    if (loading) {
        return <LoadingSpinner />;
    }

    if (!profileData) {
        return <div className="text-red-500">Profile not found.</div>;
    }

    return (
        <div className="space-y-6">
            <div className={`${colors.bg.secondary} rounded-xl p-6 border ${colors.border}`}>
                <div className="flex items-center gap-4">
                    <div className="w-16 h-16 bg-[#58A6FF]/10 rounded-full flex items-center justify-center">
                        <span className="text-2xl text-[#58A6FF]">
                            {profileData.username.charAt(0)}
                        </span>
                    </div>
                    <div>
                        <h2 className={`text-xl font-semibold ${colors.text.primary}`}>
                            {profileData.username}
                        </h2>
                        <p className={colors.text.secondary}>Member since 2024</p>
                    </div>
                </div>
            </div>

            <div className="grid grid-cols-2 gap-4">
                <div className={`${colors.bg.secondary} rounded-xl p-4 border ${colors.border}`}>
                    <h3 className={colors.text.secondary}>Resources Posted</h3>
                    <p className="text-2xl text-[#58A6FF]">
                        {profileData.resourcesShared || 0}
                    </p>
                </div>
                <div className={`${colors.bg.secondary} rounded-xl p-4 border ${colors.border}`}>
                    <h3 className={colors.text.secondary}>Resources Completed</h3>
                    <p className="text-2xl text-[#58A6FF]">
                        {profileData.resourcesCompleted || 0}
                    </p>
                </div>
            </div>
        </div>
    );
};

const handlePostResource = async (resourceData) => {
    if (!user) {
        alert('Please log in to post a resource.');
        return;
    }

    setIsPosting(true);
    setPostError('');

    try {
        const newResource = {
            ...resourceData,
            postedBy: user.uid,
            createdAt: firebase.database.ServerValue.TIMESTAMP,
        };

        const ref = firebase.database().ref('resources').push();
        await ref.set(newResource);

        // Increment resourcesShared count
        const userRef = firebase.database().ref(`users/${user.uid}`);
        const snapshot = await userRef.once('value');
        const userData = snapshot.val();
        const updatedResourcesShared = (userData.resourcesShared || 0) + 1;

        await userRef.update({ resourcesShared: updatedResourcesShared });

        setPostSuccess(true);
        setTimeout(() => setPostSuccess(false), 3000);

        await loadResources();
    } catch (error) {
        setPostError('Failed to post resource. Please try again.');
        console.error('Error posting resource:', error);
    } finally {
        setIsPosting(false);
    }
};

    // Main App Component
    function App() {
      const [user, setUser] = React.useState(null);
    const [showAuth, setShowAuth] = React.useState(false);
    const [isLogin, setIsLogin] = React.useState(true);
    const [currentPage, setCurrentPage] = React.useState('main');
    const [resources, setResources] = React.useState([]);
    const [savedResources, setSavedResources] = React.useState([]);
    const [searchQuery, setSearchQuery] = React.useState('');
    const [aiSuggestedResources, setAISuggestedResources] = React.useState([]);
    const [isOverwhelmed, setIsOverwhelmed] = React.useState(false);
    const [currentTip, setCurrentTip] = React.useState(QUICK_TIPS[0]);
    const [userProfile, setUserProfile] = React.useState(null);
    const [loading, setLoading] = React.useState(true);
    const [isPosting, setIsPosting] = React.useState(false);
    const [postSuccess, setPostSuccess] = React.useState(false);
    const [postError, setPostError] = React.useState('');

    const handleAISearch = async function(query) {
  if (!query.trim()) return;
  
  setLoading(true);
  try {
    const suggestions = await fetchAIResources(query);
    setAISuggestedResources(suggestions);
  } catch (error) {
    console.error('Search error:', error);
    setAISuggestedResources([{
      id: 'error-1',
      title: 'Error Getting Suggestions',
      description: 'Failed to get AI suggestions. Please try again.',
      timeToComplete: 'N/A',
      tags: ['Error'],
      progress: 0,
      postedBy: 'System',
      likes: 0,
      liked: false
    }]);
  } finally {
    setLoading(false);
  }
};

    // Load resources from Firebase Realtime Database
    const loadResources = async () => {
    try {
        const snapshot = await firebase.database().ref('resources').once('value');
        const resourcesData = [];

        snapshot.forEach((childSnapshot) => {
            const resource = childSnapshot.val();
            console.log("Resource:", resource); // Log each resource
            resourcesData.push({
                id: childSnapshot.key,
                ...resource,
            });
        });

        setResources(resourcesData);
    } catch (error) {
        console.error('Error loading resources:', error);
    }
};

    // Handle resource posting
    const handlePostResource = async (resourceData) => {
        if (!user) {
            alert('Please log in to post a resource.');
            return;
        }

        setIsPosting(true);
        setPostError('');

        try {
            const newResource = {
                ...resourceData,
                postedBy: user.uid,
                createdAt: firebase.database.ServerValue.TIMESTAMP,
            };

            const ref = firebase.database().ref('resources').push();
            await ref.set(newResource);

            setPostSuccess(true);
            setTimeout(() => setPostSuccess(false), 3000); // Hide success message after 3 seconds

            // Refresh resources after posting
            await loadResources();
        } catch (error) {
            setPostError('Failed to post resource. Please try again.');
            console.error('Error posting resource:', error);
        } finally {
            setIsPosting(false);
        }
    };

    


    // Handle saving resources
    const handleSaveResource = async (resourceId) => {
        if (!user) {
            alert('Please log in to save a resource.');
            return;
        }

        try {
            const userRef = firebase.database().ref(`users/${user.uid}/savedResources`);
            const snapshot = await userRef.once('value');
            const savedResources = snapshot.val() || [];

            if (!savedResources.includes(resourceId)) {
                await userRef.set([...savedResources, resourceId]);
                setSavedResources(prev => [...prev, resourceId]);
            } else {
                // If the resource is already saved, remove it
                const updatedSavedResources = savedResources.filter(id => id !== resourceId);
                await userRef.set(updatedSavedResources);
                setSavedResources(updatedSavedResources);
            }
        } catch (error) {
            console.error('Error saving resource:', error);
        }
    };

    const handleCompleteResource = async (resourceId) => {
    if (!user) {
        alert('Please log in to mark a resource as completed.');
        return;
    }

    try {
        const userRef = firebase.database().ref(`users/${user.uid}`);
        const snapshot = await userRef.once('value');
        const userData = snapshot.val();
        const updatedResourcesCompleted = (userData.resourcesCompleted || 0) + 1;

        await userRef.update({ resourcesCompleted: updatedResourcesCompleted });

        // Optionally, you can also mark the resource as completed in the resources table
        const resourceRef = firebase.database().ref(`resources/${resourceId}`);
        await resourceRef.update({ completed: true });

        // Update local state
        setResources(prevResources =>
            prevResources.map(res =>
                res.id === resourceId ? { ...res, completed: true } : res
            )
        );
    } catch (error) {
        console.error('Error completing resource:', error);
    }
};

    const fetchAIResources = async function(searchQuery) {
  try {
    console.log('Fetching AI resources for query:', searchQuery);
    
    const prompt = `You are an ADHD coach helping the user who says: "${searchQuery}"

Give 3 practical strategies to help them. Each strategy should be short but specific.`;

    const response = await fetch(
      'https://api-inference.huggingface.co/models/tiiuae/falcon-7b-instruct',
      {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + HF_API_KEY,
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          inputs: prompt,
          parameters: {
            max_new_tokens: 250,
            temperature: 0.7,
            top_p: 0.9,
            do_sample: true
          }
        })
      }
    );

    const data = await response.json();
    console.log('Raw AI response:', data);
    
    // Check if model is loading
    if (data.error && data.error.includes('loading')) {
      console.log('Model is loading, waiting to retry...');
      await new Promise(resolve => setTimeout(resolve, 2000));
      return fetchAIResources(searchQuery);
    }

    if (!response.ok) {
      throw new Error(data.error || 'Failed to get AI suggestions');
    }

    // Get the generated text
    const responseText = Array.isArray(data) ? data[0].generated_text : data.generated_text;
    console.log('Generated text:', responseText);

    // If we got an empty or invalid response, return defaults
    if (!responseText || responseText.length < 10) {
      return getDefaultStrategies();
    }

    // Try to extract strategies from the response
    const strategies = [];
    const lines = responseText.split('\n').filter(function(line) { return line.trim(); });
    let currentStrategy = null;

    for (let i = 0; i < lines.length; i++) {
      const line = lines[i].trim();
      
      // Look for numbers at start of line to identify new strategies
      if (/^[1-3][.:]/.test(line) || /Strategy \d+:/i.test(line)) {
        if (currentStrategy) {
          strategies.push(currentStrategy);
        }
        currentStrategy = {
          id: 'ai-' + strategies.length + '-' + Date.now(),
          title: line.replace(/^[1-3][.:]|Strategy \d+:/i, '').trim(),
          description: '',
          timeToComplete: '5-10 minutes',
          tags: ['AI Suggested', 'ADHD-friendly'],
          progress: 0,
          postedBy: 'AI Assistant',
          likes: 0,
          liked: false
        };
      } else if (currentStrategy) {
        currentStrategy.description += (currentStrategy.description ? '\n' : '') + line;
      }
    }

    if (currentStrategy) {
      strategies.push(currentStrategy);
    }

    // If we got good strategies, clean them up and return
    if (strategies.length > 0) {
      return strategies.map(function(strategy) {
        return {
          ...strategy,
          // Clean up empty titles
          title: strategy.title || 'Strategy',
          // Clean up empty descriptions
          description: strategy.description || 'Focus on one task at a time and break it into smaller steps.'
        };
      });
    }

    // If we couldn't parse strategies, try a simpler split
    const simpleStrategies = responseText
      .split(/\d\.|\n\n/)
      .filter(function(text) { return text.trim(); })
      .slice(0, 3)
      .map(function(text, index) {
        const lines = text.trim().split('\n');
        return {
          id: 'ai-' + index + '-' + Date.now(),
          title: 'Strategy ' + (index + 1),
          description: lines.join('\n'),
          timeToComplete: '5-10 minutes',
          tags: ['AI Suggested', 'ADHD-friendly'],
          progress: 0,
          postedBy: 'AI Assistant',
          likes: 0,
          liked: false
        };
      });

    // If we got at least one strategy, pad with defaults if needed
    if (simpleStrategies.length > 0) {
      while (simpleStrategies.length < 3) {
        const defaults = getDefaultStrategies();
        simpleStrategies.push(defaults[simpleStrategies.length]);
      }
      return simpleStrategies;
    }

    // If all else fails, return defaults
    return getDefaultStrategies();

  } catch (error) {
    console.error('AI Error:', error);
    return getDefaultStrategies();
  }
};

// Memoize the resource loading functions
const loadUserData = React.useCallback(async (userId) => {
    try {
        const snapshot = await firebase.database().ref(`users/${userId}`).once('value');
        const userData = snapshot.val();
        setUserProfile(userData || { username: 'User', resourcesShared: 0, resourcesCompleted: 0 });
    } catch (error) {
        console.error('Error loading user data:', error);
    }
}, []);

// Fix the useEffect hooks with proper dependencies
React.useEffect(() => {
    const unsubscribe = auth.onAuthStateChanged((user) => {
        setUser(user);
        if (user) {
            loadUserData(user.uid);
            loadResources();
        } else {
            setUserProfile(null);
        }
        setLoading(false);
    });
    return () => unsubscribe();
}, [loadUserData, loadResources]);

React.useEffect(() => {
    const interval = setInterval(() => {
        setCurrentTip(prev => {
            const currentIndex = QUICK_TIPS.indexOf(prev);
            return QUICK_TIPS[(currentIndex + 1) % QUICK_TIPS.length];
        });
    }, 10000);
    return () => clearInterval(interval);
}, [QUICK_TIPS]); // Added QUICK_TIPS as dependency

// Memoize the renderContent function
const renderContent = () => {
    if (loading) return <LoadingSpinner />;

    if (currentPage.startsWith('profile-')) {
        const userId = currentPage.split('-')[1];
        return <ProfilePage userId={userId} />;
    }

    switch (currentPage) {
        case 'main':
            return (
                <div>
                    <QuickWinCard
                        currentTip={currentTip}
                        onOverwhelm={() => setIsOverwhelmed(true)}
                    />
                    
                    <AISuggestionsSection
                        onSubmit={handleAISearch}
                        isLoading={loading}
                    />

                    {aiSuggestedResources.length > 0 && (
                        <div className="space-y-4 mb-8">
                            <h3 className={'text-lg font-medium ' + colors.text.primary}>
                                AI Suggested Strategies:
                            </h3>
                            {aiSuggestedResources.map((resource) => (
                                <ResourceCard
                                    key={resource.id}
                                    resource={resource}
                                    onUpvote={handleUpvote}
                                    onDownvote={handleDownvote}
                                    onSave={handleSaveResource}
                                    isSaved={savedResources.includes(resource.id)}
                                />
                            ))}
                        </div>
                    )}

                    <div className="space-y-4">
                        <h3 className={'text-lg font-medium ' + colors.text.primary}>
                            Community Resources
                        </h3>
                        {resources
                            .filter((resource) => {
                                if (!resource || !searchQuery) return true;
                                const query = searchQuery.toLowerCase();
                                return (
                                    (resource.title || '').toLowerCase().includes(query) ||
                                    (resource.description || '').toLowerCase().includes(query)
                                );
                            })
                            .map((resource) => (
                                <ResourceCard
                                    key={resource.id}
                                    resource={resource}
                                    onUpvote={handleUpvote}
                                    onDownvote={handleDownvote}
                                    onSave={handleSaveResource}
                                    isSaved={savedResources.includes(resource.id)}
                                />
                            ))}
                    </div>
                </div>
            );

        case 'discover':
            return (
                <DiscoverPage
                    resources={resources}
                    onUpvote={handleUpvote}
                    onDownvote={handleDownvote}
                    onSave={handleSaveResource}
                    savedResources={savedResources}
                    setCurrentPage={setCurrentPage}
                />
            );

        case 'post':
            return (
                <PostPage
                    user={user}
                    onPost={loadResources}
                />
            );

        case 'profile':
            return (
                <ProfilePage
                    userId={user.uid}
                    userProfile={userProfile}
                    savedResources={savedResources}
                />
            );

        default:
            return null;
    }
};

return (
        <div className={`min-h-screen ${colors.bg.primary}`}>
            <header className="relative overflow-hidden">
                <div className="absolute inset-0 bg-gradient-to-r from-[#58A6FF]/5 to-[#BD6AFF]/5 blur-xl" />
                <div className="relative max-w-4xl mx-auto px-4 py-6">
                    <div className="flex justify-between items-center">
                        <h1 className="text-2xl font-bold text-[#58A6FF]">
                            Solace
                        </h1>
                        {user ? (
                            <button
                                onClick={() => auth.signOut()}
                                className={`px-4 py-2 ${colors.text.secondary} hover:text-[#58A6FF]`}
                            >
                                Sign Out
                            </button>
                        ) : (
                            <div className="space-x-4">
                                <button
                                    onClick={() => {
                                        setIsLogin(true);
                                        setShowAuth(true);
                                    }}
                                    className="px-4 py-2 text-[#58A6FF] hover:text-[#58A6FF]/80"
                                >
                                    Login
                                </button>
                                <button
                                    onClick={() => {
                                        setIsLogin(false);
                                        setShowAuth(true);
                                    }}
                                    className="px-4 py-2 bg-[#58A6FF] text-white rounded-lg hover:bg-[#58A6FF]/90"
                                >
                                    Sign Up
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            </header>

            <main className="relative max-w-4xl mx-auto px-4 py-6 space-y-6">
                {renderContent()}
            </main>

            <Navigation currentPage={currentPage} setCurrentPage={setCurrentPage} />

            {showAuth && (
                <AuthModal
                    onClose={() => setShowAuth(false)}
                    isLogin={isLogin}
                />
            )}

            {isOverwhelmed && (
                <OverwhelmModal
                    onClose={() => setIsOverwhelmed(false)}
                    user={user}
                />
            )}

            {isPosting && <LoadingSpinner />}
            {postSuccess && <SuccessMessage />}
            {postError && <ErrorMessage message={postError} />}
        </div>
    );
}

    // Render the app
    ReactDOM.createRoot(document.getElementById('root')).render(
    <ErrorBoundary>
        <App />
    </ErrorBoundary>
);
    </script>
</body>
</html>
